<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

<title>Promise</title>

<script type="text/javascript">
	'use strict';
	var coWidgetConfig = {
		isDebug : true,
		packages : {
			'mock' : '/ExampleWeb/mock/cowidget/mock'
		}
	};
</script>
<script type="text/javascript" src="http://res.rawya.net/cowidget/CoWidget.js"></script>
<body class="api">
	<code id="logger" style="tab-size: 2"> </code>

	<script type="text/javascript">
		'use strict';

		if (false) {
			cowidget.common.Log = mock.Log;
			cowidget.common.LogFactory = mock.LogFactory;
			cowidget.common.NetXhr = mock.NetXhr;

			cowidget.service;
			cowidget.service.MockService = mock.MockService;
		}

		// Resolving a thenable object
		var p1 = Promise.resolve({
			then : function(onFulfill, onReject) {
				onFulfill('fulfilled!');
			}
		});
		console.log(p1 instanceof Promise) // true, object casted to a Promise

		p1.then(function(v) {
			console.log(v); // "fulfilled!"
		}, function(e) {
			// not called
		});

		// Thenable throws before callback
		// Promise rejects
		var thenable = {
			then : function(resolve) {
				throw new TypeError('Throwing');
				resolve('Resolving');
			}
		};

		var p2 = Promise.resolve(thenable);
		p2.then(function(v) {
			// not called
		}, function(e) {
			console.error(e); // TypeError: Throwing
		});

		// Thenable throws after callback
		// Promise resolves
		var thenable = {
			then : function(resolve) {
				resolve('Resolving');
				throw new TypeError('Throwing');
			}
		};

		var p3 = Promise.resolve(thenable);
		p3.then(function(v) {
			console.log(v); // "Resolving"
			return v;
		}, function(e) {
			return e;
		});

		let x = async () => {
			p3.then(function(v) {
				console.log(v); // "Resolving"
				return v;
			}, function(e) {
				return e;
			})
			
			return await Promise.allSettled([p3])[0];
			
		};
		console.log('x: ', x());
		console.log('end');
	</script>
</body>
</html>