<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="expires" content="-1" />

<title>Proxy</title>

<script type="text/javascript">
	'use strict';
	let coWidgetConfig = {
			logger : {
				'root' : 'DEBUG'
			},
			packages : {
				debug : './debug'
			}
	};
</script>
<script type="text/javascript" src="../../cowidget/CoWidget.js"></script>
</head>

<body>
	<h1>Proxy</h1>

	<pre id="logger" style="margin: auto; width: 100%; height: 300px; overflow: scroll; border: 1px #080808 solid;"></pre>
	
	<script type="text/javascript">
		'use strict';
		
		let LOG = cowidget.common.LogFactory.getLog();

		function extend(sup, base) {
			var descriptor = Object.getOwnPropertyDescriptor(base.prototype,
					'constructor');
			base.prototype = Object.create(sup.prototype);
			const handler = {
				construct : function(target, args) {
					LOG.debug('[construct] target: ', target);
					const obj = Object.create(base.prototype);
					this.apply(target, obj, args);
					return obj;
				},
				apply : function(target, that, args) {
					LOG.debug('[apply] target, that, args: ', target, that, args);
					sup.apply(that, args);
					base.apply(that, args);
				}
			};
			var proxy = new Proxy(base, handler);
			descriptor.value = proxy;
			Object.defineProperty(base.prototype, 'constructor', descriptor);
			
			return proxy;
		}

		const Person = function(name) {
			this.name = name;
		};

		const Fork = extend(Person, function(name, age) {
			this.age = age;
		});

		Fork.prototype.sex = 'M';

		var fork = new Fork('Fork', 13);
		LOG.debug('fork.sex: ', Fork.sex); // "M"
		LOG.debug('fork.name: ', Fork.name); // "Peter"
		LOG.debug('fork.age: ', Fork.age); // 13
	</script>
</body>
</html>